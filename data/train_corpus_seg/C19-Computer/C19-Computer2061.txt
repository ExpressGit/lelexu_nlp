计算机 工程 
 COMPUTERENGINEERING 
 1999 年 第 25 卷 第 5 期 Vol.25 No.51999 
 
 
 
 高速 计算机 开发 系统 断点 板 的 研制 
 程 咏梅 王 备战 
 摘要 介绍 了 一种 高速 计算机 软硬件 开发 系统 断点 功能 板 （ BPB ） 的 设计 。 BPB 可 提供 实时 灵活 的 定位 断点 功能 。 
 关键词 断点 板 高速 计算机 仿真器 
 TheStudyofHighSpeedComputerDevelopmentSystemBreakPointBoardDesign 
 ChengYongmeiWangBeizhan 
 （ DepartmentofAulomaticControl ， NorthwestemPolytechnicalUniversityXian710072 ） 
 [ Abstract ] Inthispaper ， designofahighspeedcomputerdevelopmentsystembreakpointboard （ BPB ） isintroduced 。 BPBpossessesrealtimeandagilelocationbreakpointfunction 
 [ Keywords ] Breakpointboard ； Highspeedcomputer ； Emulator 
 　 　 高速 计算机 受 应用环境 的 限制 ， 它 在 可靠性 ， 功耗 ， 体积 及 重量 等 方面 都 有 严格 的 要求 。 它 是 一台 总线 对外 ， 缺乏 对外 交流 手段 的 封闭式 机器 。 在 标准 模块 整机 应用 系统 的 研制 和 开发 过程 中 ， 要 想 缩短 研制 周期 ， 提高 研制 效率 ， 就 必须 有 强有力 的 工具 — 软硬件 开发 系统 的 支持 。 而 开发 系统 中 的 断点 板 是 整个 系统 设计 的 一个 难点 。 它 可以 通过 对 目标 机 实行 非 屏蔽 中断 ， 对 被 调试 的 仿真 程序 提供 实时 灵活 的 定位 断点 ， 使 断点 可以 设置 在 每 一个 总线 周期 ； 对 跟踪 板 提供 启动 跟踪 和 停止 跟踪 的 信号 ， 以便 调机 人员 观察所 需 的 目标 机 总线 上 的 信号 ， 以及 提供 硬件 调试 用 的 同步 信号 等 。 
 1 开发 系统 概述 
 　 　 高速 计算机 开发 系统 主要 由 以下 3 大部分 组成 ( 如图 1 ) ： 
 
 图 1 开发 系统 结构图 
 　 　 ( 1 ) 宿主机 ， 采用 DEC 公司 以 VAX / VMS4.0 以上 操作系统 支持 下 的 VAX 系列机 。 
 　 　 ( 2 ) 仿真器 ， 主要 由 6 块 功能 板 组成 ， 即 控制板 COB ， 断点 板 BPB ， 跟踪 板 TRB ， 接口板 IFB ， 双 总线 母板 ML - BUS ， 目标 机 接口板 EMB 。 COB 的 CPU 芯片 为 Intel8086 。 
 　 　 ( 3 ) 目标 机 — 高速 计算机 。 
 　 　 宿主机 和 仿真器 之间 通过 RS - 232 串行口 联接 ， 仿真器 L ' - - BUS 连接 到 目标 机上 。 仿真器 上 的 功能 板 COB 、 BPB 、 TRB 、 IFB ， 插到 双 总线 母板 ML - BUS 上 ， 按照 目标 机 标准 插件 设计 的 目标 机 接口板 EMB ， 插 在 目标 机箱 中 ， 它 通过 3 条 60 蕊 扁平电缆 与 双 总线 母板 ML - BUS 相连 ， 通过 这 3 条 60 蕊 扁平电缆 线 的 信号 是 L ' - - Bus ( 即准 L - - Bus ) 。 这里 主要 介绍 断点 板 ( BPB ) 的 设计 特点 以及 实现 。 
 2BPB 的 结构 、 功能 以及 工作 原理 
 　 　 BPB 是 仿真器 的 主要 功能 板 之一 ， 在 系统 中 由 两块 BPB 组成 4 个 事件 ， 它 可以 使 目标 机在 连续 工作 中 ， 通过 对 每 一 事件 相应 条件 的 设置 ( 包括 地址 ， 数据 / 指令 ， 控制 / 状态 ， 外部 逻辑 ) ， 对 每 一 事件 相应 的 4 个 条件 的 逻辑 组合 设置 ， 对 每 一 事件 发生 次数 的 设置 ， 以及 对 4 个 事件 与 相应 事件 发生 次数 逻辑 组合 设置 ， 来 达到 对 目标 机 实行 非 屏蔽 中断 ， 对 跟踪 板 提供 启动 跟踪 和 停止 跟踪 的 信号 ， 提供 硬件 调试 用 的 同步 信号 等 。 每 一块 BPB 板 主要 由 6 个 部分 组成 ， 它们 是 ： 输入输出 信号 的 驱动 电路 ； BPB 特征 码 的 产生 ； 事件 条件 的 产生 ； 组成 事件 的 条件 的 逻辑 组合 ； 事件 计数器 ； 事件 及其 相应 事件 计数 的 逻辑 组合 和 激活 信号 电路 ， 它 的 功能 框图 如图 2 ， 下面 分别 叙述 。 
 
 图 2BPB 功能 框图 
 2.1 输入 、 输出 信号 的 驱动 电路 
 　 　 这部分 主要 由 74F244 ， 74F245 单向 ， 双向 驱动器 组成 。 所有 输入 、 输出 信号 通过 驱动 ， 可以 使 信号 提高 驱动 能力 ， 改善 信号 的 性能 。 为了 说明 问题 ， 分 以下 7 个 部分 叙述 。 
 　 　 ( 1 ) 对 8086 来 的 数据信号 控制 把 断点 板 安排 在 8086 地址 的 6000 ～ 7000 段 内 。 数据线 用 74F245 驱动 ， 它 的 使 能 信号 是 段 号 和 口 地址 00F8 ( 00F8 由 IFB 生成 ， 用来 形成 BPB 的 特征 码 ) 一起 控制 。 
 　 　 ( 2 ) 对 8086 来 的 地址 信号 控制 用 命令 态 有效 控制 驱动 地址 信号 的 74F244 的 使 能 端 ， 此时 CPU 的 地址总线 对 BPB 开放 。 
 　 　 ( 3 ) 对 8086 来 的 控制 信号 的 控制 8086 的 控制 信号 只有 在 6000 ～ 7000 段 内 才 对 BPB 有效 ， 所以 用段 信号 控制 74F244 的 使 能 端 。 
 　 　 ( 4 ) 对 接口板 IFB 来 的 信号 的 控制 接口板 ( IFB ) 来 的 信号 有 2 个 ( 运行 态 ) ， ( 命令 态 ) ， 通过 单向 驱动器 输入 ， 常开 ， 不 受 控制 。 受 禁止 存储器 信号 DISMEN 的 控制 ， 这样 可 使 目标 机上 的 用户程序 断点 与 仿真器 的 程序 不 发生冲突 。 
 　 　 ( 5 ) 对 来自 目标 机 接口板 ( 或 仿真 板 EMB ) 的 信号 的 控制 EMB 的 信号 通过 驱动器 时 由 运行 态 信号 RUN 控制 。 
 　 　 ( 6 ) 2 # ， 3 # 事件 及其 事件 计数 的 输入输出 控制 用 2 块 BPB 板 构成 4 个 事件 及 事件 计数 ， 事件 的 驱动 和 逻辑 组合 在 BPB1 上 完成 ， BPB2 两 事件 ( 包括 事件 计数 ) 通过 BPB2 输出 ( 常开 ) ， 再 通过 BPB1 输入 ， 由 RUN 控制 74F244 使能 端 。 
 　 　 ( 7 ) 触发 信号 输出 电路 的 控制 4 个 事件 及 4 个 事件 计数 组合 产生 的 8 个 触发 信号 ， 在 RUN 的 控制 下 通过 74F244 输出 。 
 2.2 BPB 特征 码 的 产生 
 　 　 特征 码 电路 由 74F373 ( 8 位锁 存器 ) 及 74F138 ( 3 - 8 译码器 ) 组成 。 由于 断点 板 的 部分 地址 是 重叠 的 ， 因此 8086 读写 BPB 时 ， 必须 给出 对应 部分 的 特征 码 。 我们 对 I / O 口 地址 00F8 ， 通过 D0 - D4 组合成 32 个数 ， 对 00F8 进行 32 次 I / O 写 ， 就 可以 获得 32 个 特征 码 ， 也 就 对 断点 板 的 各个 对应 部分 选通 了 。 实际 断点 板 只用 了 27 个 特征 码 。 由于 篇幅 所 限 ， 特征 码 使用 对照表 未 列出 。 
 2.3 事件 条件 的 产生 
 　 　 0 号 ， 2 号 事件 由 地址 、 数据 / 指令 、 状态 / 控制 、 外部 逻辑 4 个 条件 产生 ， 1 号 3 号 事件 除 外部 逻辑 外由 3 个 条件 产生 ， 这部分 主要 由 4 输入 2 选 1 锁 存器 74F298 以及 64k × 1 位 RAMF1600 、 8 位 比较 器 74F688 、 74F373 组成 。 这些 条件 的 逻辑 组合 ， 产生 各种 条件 下 的 事件 ， 当 用户 程序运行 时 ， 总线 上 信号 与 设置 的 信号 相符合 ， 就 形成 了 事件 条件 输出 。 工作 原理 如下 ： 
 　 　 ( 1 ) 地址 条件 的 复合 
 　 　 对 目标 机 来说 ， 可以 对 它 2MB 的 地址 范围 设置 断点 ， 其中 1MB 是 数据 区 ， 另外 1MB 是 指令区 。 由于 目标 机 的 地址 管理 分 两种 情况 ， 有 目标 机 时 ， 逻辑 地址 的 ADR4 ～ ADR15 加上 扩展 地址 的 8 位 EADR0 ～ EADR7 ， 以 形成 20 位 物理地址 。 无 目标 机 时 逻辑 地址 ADR0 ～ ADR15 就是 实际 的 物理地址 。 使用 的 F1600 寄存器 ， 只有 16 位 地址 线 ， 它 只能 寄存 64kB 的 地址 范围 ， 为了 扩大 地址 范围 到 2MB ， 在 命令 态时 ， 用 8086 的 5 位 数据线 D0 ～ D4 对 页面 簇及 D / I 条件 进行 预置 ， 即锁 存到 74F373 内 ， 在 运行 态 ， 通过 74F688 与 L - BUS 来 的 信号 EADR0 ～ EADR3 ， D / I 进行 复合 ( 也 就是 通过 比较 器 进行 比较 ) ， 如果 相同 ， 就 产生 复合 输出 ， EADR4 ～ EADR7 以及 ADR4 ～ ADR15 这 16 位 地址 信号 的 复合 是 靠 4 个 74F298 及 1 个 F1600 来 完成 的 ， 在 命令 态时 8086 对 F1600 的 64kB 地址 范围 内 的 某 单元 写入 0 。 由于 F1600 是 1 位 存储器 ， 因此 它 通过 8086 的 数据线 D0 或 D4 来 完成 ( 0 号 ， 2 号 事件 用 D0 ， 1 号 ， 3 号 事件 用 D4 ) ， 当 目标 机 运行 时 ， L - BUS 总线 上 出现 的 地址 与 设置 的 地址 相同 ， 就读 出该 单元 的 内容 0 ， 这个 信号 与 74F688 复合 出来 的 信号 相 或 ， 就 实现 了 地址 的 复合 ， 也 就 产生 了 地址 条件 。 
 　 　 ( 2 ) 数据 / 指令 条件 的 复合 
 　 　 在 命令 态 ， 通过 F1600 可以 对 目标 机 数据 / 指令 在 0 ～ FFFF 种 编码 中 进行 断点 设置 ， 用 8086 的 16 位 地址 信号 对 数据位 D1 、 D5 ( D1 是 0 号 和 2 号 事件 ， D5 是 1 号 和 3 号 事件 ) 进行 写 操作 ， 即 写入 0 ， 这样 就 设置 了 数据 / 指令 的 条件 ， 在 运行 态 ， 目标 机 总线 上 的 数据 / 指令 信号 如果 和 8086 设置 的 相同 时 ， 就读 出 对应 单元 的 信号 0 ， 这个 低电平 信号 是 数据 / 指令 条件 的 复合 信号 。 
 　 　 ( 3 ) 控制 / 状态 条件 的 复合 
 　 　 在 命令 态 ， 用 8086 的 16 位 地址 信号 对 数据位 D2 、 D6 ( D2 是 0 号 和 2 号 事件 ， D6 是 1 号 和 3 号 事件 ) 进行 写 0 ， 就 完成 了 该 条件 的 设置 。 复合 时 读出 0 ， 这个 信号 就是 控制 / 状态 复合 信号 。 
 　 　 ( 4 ) 外部 逻辑 条件 的 复合 
 　 　 外部 逻辑 是 用 8086 的 8 位 地址 信号 对 数据位 D3 进行 写 0 操作 ， 所以 在 命令 态时 ， 只 可以 对 0 ～ FF 种 编码 的 外部 逻辑 进行 断点 设置 ， 运行 时 ， 当 外部 逻辑 信号 与 所 设置 的 信号 相吻合 时 ， 就读 出 了 对应 单元 的 0 信号 ， 这个 低电平 信号 就是 外部 逻辑 条件 的 复合 信号 。 
 2.4 组成 事件 条件 的 逻辑 组合 
 　 　 这部分 电路 主要 由 74F244 和 256 × 9 位 的 RAMF93479 组成 。 对 产生 事件 的 4 个 条件 的 各种 逻辑 组合 进行 设置 ， 以 实现 对 目标 机 程序运行 全过程 观察 ， 和 别的 事件 进一步 组合 ， 提高 触发 功能 。 只 需 使用 F93479 的 AL0 ～ AL34 位 地址 线 和 D0 位 数据线 ， 所以 只能 对 16 种 组合 进行 设置 ， 在 命令 态时 ， 8086 通过 对 F93479 的 16 个 单元 的 D0 位 设置 ， 设置 为 0 ， 在 运行 时 ， 如果 4 个 条件 有效 组合 起来 产生 的 值 与 设置 单元 的 地址 相同 ， 就 将 该 地址 单元 的 内容 读出 ， 读出 的 是 低电平 ， 这 就 实现 了 事件 的 复合 ， 事件 复合 的 低电平 信号 送到 下 一级 组合 电路 。 
 2.5 事件 计数器 
 　 　 事件 计数 采用 的 是 8 位 计数器 74F593 ， 它 是 带 预置 寄存器 的 二进制 计数器 。 在 目标 机 运行 时 ， 通过 这一 电路 来 统计 每一 事件 发生 的 次数 。 在 命令 态时 ， 是 对 74F593 进行 预置 ， 通过 8086 对 D0 ～ D7 这 8 位 进行 写 操作 来 实现 的 ， 当 事件 发生 时 ， 累加 计数 加至 满时 ， 产生 满 信号 ， 送 下 一级 组合 电路 。 
 2.6 事件 ， 事件 重复 次数 及 激活 电路 
 　 　 这 一部分 电路 由 F93479 组成 。 它 可以 对 4 个 事件 及其 相应 事件 计数 的 逻辑 组合 进行 预置 ， 对 8 个 触发 信号 进行 预置 ， 当 预置 的 条件 复合 时 ， 激活 事先 预置 好 的 8 个 触发 信号 。 断点 板 的 最终 目的 主要 体现 在 这 一部分 电路 上 ， 设置 以上 事件 的 条件 ， 以及 事件 条件 的 组合 ， 最终 就是 要 使 它 对系统 产生 作用 ， 使用 F93479 的 8 位 地址 线 和 8 位 数据线 ， 在 命令 态 ， 对 它 的 8 位 地址 进行 预置 ， 也 就是 事件 及 事件 计数 逻辑 组合 的 预置 ， 并且 对 它 的 对应 单元 的 8 位 数据 ， 按 系统 需要 进行 预置 ， 也 就是 对 某 地址 单元 进行 写 操作 ， 在 目标 机 运行 时 ， 当 4 个 事件 及其 相应 的 计数 的 逻辑 组合 与 事先 预置 的 地址 相同 时 ， 就 对 该 地址 单元 的 内容 进行 读 ， 8 位 数据线 就 按照 事先 预置 的 情况 ， 有 相应 的 信号 输出 ， 对系统 的 运行 产生 了 作用 ， 如 D0 有 输出 ， 就 产生 系统 的 非 屏蔽 中断 等 。 8 位 地址 线 和 8 位 数据线 对应 的 信号 表 ， 由于 篇幅 所限未 列出 。 
 　 　 以上 是 仿真器 BPB 的 设计 的 详细 过程 ， 主要 的 思想 是 利用 F1600 和 F93479 这 两种 存储器 ， 对 存储器 的 写 ， 就是 对 条件 的 设置 ， 对 存储 设置 好 单元 的 读 ， 就是 条件 的 复合 。 通过 BPB ， 可以 对 目标 机 仿真 程序 进行 实时 灵活 的 断点 设置 ， 从而 为 软硬件 的 调试 提供 了 良好 的 手段 。 
 * 国家 重点 科研项目 
 作者简介 ： 程 咏梅 女 ， 37 岁 ， 博士 ， 主攻 高速 计算机 ， 并行 计算机 及 并行算法 。 
 作者 单位 ： 西北工业大学 自动控制 系 西安 710072 
 参考文献 
 1 航空工业总公司 第 631 所 资料室 编 . 高速 计算机 指令系统 结构 及 硬件资源 . 1986 
 2 杜毅仁 ， 李慕 竭编 . 16 位 微型 计算机 . ( 上 、 中 、 下册 ) . 上海 ： 上海交通大学 出版社 ， 1986 
 收稿 日期 ： 1998 - 06 - 12 
